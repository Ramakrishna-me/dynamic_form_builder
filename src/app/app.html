<div class="wrapper">

  <!-- TOP BAR -->
  <div class="topbar">
    <h1>Dynamic Form Builder</h1>

    <div class="top-actions">
      <button class="btn ghost" (click)="toggleTheme()">{{ darkTheme ? 'Light' :
        'Dark' }}</button>
      <button class="btn" (click)="exportSchema()">Export JSON</button>

      <label class="btn file-btn">
        Import JSON
        <input type="file" hidden accept="application/json"
          (change)="handleJsonFileInput($any($event.target).files[0])">
      </label>

      <button class="btn ghost" (click)="addGroup()">+ Group</button>
      <button class="btn ghost" (click)="addSection()">+ Section</button>
      <button class="btn" (click)="addHiddenField()">+ Hidden</button>
    </div>
  </div>

  <!-- MAIN GRID -->
  <div class="content">

    <!-- BUILDER PANEL -->
    <aside class="builder-panel glass-card">
      <h2>Field Builder</h2>

      <form [formGroup]="builderForm">

        <!-- ROW 1 -->
        <div class="row">
          <label>Type
            <select formControlName="type">
              <option value="text">Text</option>
              <option value="number">Number</option>
              <option value="email">Email</option>
              <option value="password">Password</option>
              <option value="textarea">Textarea</option>
              <option value="select">Select</option>
              <option value="radio">Radio</option>
              <option value="checkbox">Checkbox</option>
              <option value="date">Date</option>
              <option value="time">Time</option>
            </select>
          </label>

          <label>Label
            <input formControlName="label" placeholder="Field label" />
          </label>
        </div>

        <!-- ROW 2 -->
        <div class="row">
          <label>Placeholder
            <input formControlName="placeholder" placeholder="Placeholder" />
          </label>

          <label>Options (comma)
            <input formControlName="options" placeholder="Option1, Option2" />
          </label>
        </div>

        <!-- ROW 3 -->
        <div class="row">
          <label>Group
            <select formControlName="group">
              <option value>— none —</option>
              <option *ngFor="let g of groups" [value]="g.title">{{ g.title
                }}</option>
            </select>
          </label>

          <label class="small">Required
            <input type="checkbox" formControlName="required" />
          </label>
        </div>

        <!-- ROW 4 -->
        <div class="row">
          <label>Min
            <input type="number" formControlName="min" placeholder="min" />
          </label>

          <label>Max
            <input type="number" formControlName="max" placeholder="max" />
          </label>
        </div>

        <!-- ROW 5 -->
        <div class="row">
          <label>Pattern (regex)
            <input formControlName="pattern" placeholder="^[A-Z].*" />
          </label>

          <label class="small">Multiple
            <input type="checkbox" formControlName="multiple" />
          </label>
        </div>

        <!-- ACTIONS -->
        <div class="row actions">
          <button class="btn" type="button" (click)="addField()">Add
            field</button>
          <button class="btn ghost" type="button" (click)="updateField()"
            [disabled]="selectedFieldIndex === null">Update</button>
        </div>

      </form>

      <!-- FIELD LIST -->
      <h3>Fields</h3>
      <div class="fields-list" cdkDropList (cdkDropListDropped)="drop($event)">
        <div class="field-item" *ngFor="let f of fields; index as i" cdkDrag>

          <div class="left">
            <div class="title">
              {{ f.label }} <small class="muted">{{ f.type }}</small>
            </div>
            <div *ngIf="f.group" class="group-pill">{{ f.group }}</div>
          </div>

          <div class="controls">
            <button class="btn tiny" (click)="editField(i)">Edit</button>
            <button class="btn tiny ghost"
              (click)="duplicateField(i)">Duplicate</button>
            <button class="btn tiny ghost"
              (click)="removeField(i)">Delete</button>
          </div>

        </div>
      </div>

    </aside>

    <!-- PREVIEW PANEL -->
    <section class="preview-panel neumorph-card">
      <h2>Form Preview</h2>

      <form [formGroup]="dynamicForm" (ngSubmit)="submit()"
        class="preview-form">

        <ng-container *ngFor="let f of fields">

          <!-- SECTION -->
          <div *ngIf="f.type === 'section'" class="section">
            <h3>{{ f.label }}</h3>
          </div>

          <!-- INPUT FIELDS -->
          <div *ngIf="f.type !== 'section'" class="control"
            [class.hidden]="dynamicForm.get(f.id)?.disabled">

            <!-- TEXT / EMAIL / NUMBER / PASSWORD / TIME / DATE -->
            <label
              *ngIf="['text','email','number','password','date','time'].includes(f.type)">
              {{ f.label }}
              <input
                [type]="f.type"
                [placeholder]="f.placeholder"
                [formControlName]="f.id" />
            </label>

            <!-- TEXTAREA -->
            <label *ngIf="f.type === 'textarea'">
              {{ f.label }}
              <textarea [placeholder]="f.placeholder"
                [formControlName]="f.id"></textarea>
            </label>

            <!-- SELECT -->
            <label *ngIf="f.type === 'select'">
              {{ f.label }}
              <select [formControlName]="f.id"
                [attr.multiple]="f.meta?.multiple ? '' : null">
                <option value>— select —</option>
                <option *ngFor="let o of optionList(f)" [value]="o">{{ o
                  }}</option>
              </select>
            </label>

            <!-- RADIO -->
            <div *ngIf="f.type === 'radio'">
              <div>{{ f.label }}</div>
              <label *ngFor="let o of optionList(f)">
                <input type="radio" [value]="o" [formControlName]="f.id" /> {{ o
                }}
              </label>
            </div>

            <!-- CHECKBOX -->
            <label *ngIf="f.type === 'checkbox'">
              <input type="checkbox" [formControlName]="f.id" /> {{ f.label }}
            </label>

            <!-- HIDDEN -->
            <input *ngIf="f.type === 'hidden'" type="hidden"
              [formControlName]="f.id" />

          </div>

        </ng-container>

        <!-- SUBMIT + WEBHOOK -->
        <div class="submit-row">
          <label class="webhook">
            Webhook URL
            <input
              [formControl]="getCtrl(importForm, 'webhookUrl')"
              placeholder="https://api.example.com/submit" />
          </label>

          <button class="btn primary" type="submit">Submit</button>
          <button class="btn ghost" type="button"
            (click)="exportSchema()">Export Schema</button>
        </div>

      </form>

      <div class="hint">
        <strong>Tip:</strong> Drag fields to reorder. Conditional fields will
        auto-hide.
      </div>

    </section>
  </div>

  <!-- FOOTER -->
  <footer class="footer glass-card">
    <div>Built with ❤️ — single-component module-based Angular app</div>
    <div class="small muted">Autosave: localStorage — schema stored
      automatically.</div>
  </footer>
</div>
